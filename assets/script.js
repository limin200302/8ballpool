const vipDataCash = [
  {
    name: "Silver",
    logo: "assets/img/silver.png",
    prices: [
      { label: "Rp 55.000 - 605 Cash", value: 55000 },
      { label: "Rp 70.000 - 880 Cash", value: 70000 },
      { label: "Rp 95.000 - 1.210 Cash", value: 95000 },
      { label: "Rp 135.000 - 1.892 Cash", value: 135000 },
      { label: "Rp 190.000 - 2.992 Cash", value: 190000 },
      { label: "Rp 250.000 - 3.872 Cash", value: 250000 },
      { label: "Rp 275.000 - 6.600 Cash", value: 275000 }
    ]
  },
  {
    name: "Gold",
    logo: "assets/img/gold.png",
    prices: [
      { label: "Rp 55.000 - 688 Cash", value: 55000 },
      { label: "Rp 70.000 - 1.000 Cash", value: 70000 },
      { label: "Rp 95.000 - 1.375 Cash", value: 95000 },
      { label: "Rp 135.000 - 2.150 Cash", value: 135000 },
      { label: "Rp 190.000 - 3.400 Cash", value: 190000 },
      { label: "Rp 250.000 - 4.400 Cash", value: 250000 },
      { label: "Rp 275.000 - 7.500 Cash", value: 275000 }
    ]
  },
  {
    name: "Zamrud",
    logo: "assets/img/zamrud.png",
    prices: [
      { label: "Rp 55.000 - 825 Cash", value: 55000 },
      { label: "Rp 70.000 - 1.200 Cash", value: 70000 },
      { label: "Rp 95.000 - 1.650 Cash", value: 95000 },
      { label: "Rp 135.000 - 2.580 Cash", value: 135000 },
      { label: "Rp 190.000 - 4.080 Cash", value: 190000 },
      { label: "Rp 250.000 - 5.280 Cash", value: 250000 },
      { label: "Rp 275.000 - 9.000 Cash", value: 275000 }
    ]
  },
  {
    name: "Diamond",
    logo: "assets/img/diamond.png",
    prices: [
      { label: "Rp 55.000 - 963 Cash", value: 55000 },
      { label: "Rp 70.000 - 1.400 Cash", value: 70000 },
      { label: "Rp 95.000 - 1.925 Cash", value: 95000 },
      { label: "Rp 135.000 - 3.010 Cash", value: 135000 },
      { label: "Rp 190.000 - 4.760 Cash", value: 190000 },
      { label: "Rp 250.000 - 6.160 Cash", value: 250000 },
      { label: "Rp 275.000 - 10.500 Cash", value: 275000 }
    ]
  },
  {
    name: "Black Diamond",
    logo: "assets/img/blackdiamond.png",
    prices: [
      { label: "Rp 55.000 - 1.100 Cash", value: 55000 },
      { label: "Rp 70.000 - 1.600 Cash", value: 70000 },
      { label: "Rp 95.000 - 2.200 Cash", value: 95000 },
      { label: "Rp 135.000 - 3.440 Cash", value: 135000 },
      { label: "Rp 190.000 - 5.440 Cash", value: 190000 },
      { label: "Rp 250.000 - 7.040 Cash", value: 250000 },
      { label: "Rp 275.000 - 12.000 Cash", value: 275000 }
    ]
  }
];

const vipDataBox = [
  {
    name: "Silver",
    logo: "assets/img/silver.png",
    prices: [
      { label: "Rp 60.000 - 20 Box", value: 60000 },
      { label: "Rp 75.000 - 29 Box", value: 75000 },
      { label: "Rp 100.000 - 40 Box", value: 100000 },
      { label: "Rp 145.000 - 63 Box", value: 145000 },
      { label: "Rp 200.000 - 100 Box", value: 200000 },
      { label: "Rp 265.000 - 130 Box", value: 265000 },
      { label: "Rp 295.000 - 222 Box", value: 295000 }
    ]
  },
  {
    name: "Gold",
    logo: "assets/img/gold.png",
    prices: [
      { label: "Rp 60.000 - 22 Box", value: 60000 },
      { label: "Rp 75.000 - 33 Box", value: 75000 },
      { label: "Rp 100.000 - 45 Box", value: 100000 },
      { label: "Rp 145.000 - 72 Box", value: 145000 },
      { label: "Rp 200.000 - 114 Box", value: 200000 },
      { label: "Rp 265.000 - 149 Box", value: 265000 },
      { label: "Rp 295.000 - 252 Box", value: 295000 }
    ]
  },
  {
    name: "Zamrud",
    logo: "assets/img/zamrud.png",
    prices: [
      { label: "Rp 60.000 - 27 Box", value: 60000 },
      { label: "Rp 75.000 - 39 Box", value: 75000 },
      { label: "Rp 100.000 - 54 Box", value: 100000 },
      { label: "Rp 145.000 - 86 Box", value: 145000 },
      { label: "Rp 200.000 - 137 Box", value: 200000 },
      { label: "Rp 265.000 - 117 Box", value: 265000 },
      { label: "Rp 295.000 - 303 Box", value: 295000 }
    ]
  },
  {
    name: "Diamond",
    logo: "assets/img/diamond.png",
    prices: [
      { label: "Rp 60.000 - 32 Box", value: 60000 },
      { label: "Rp 75.000 - 46 Box", value: 75000 },
      { label: "Rp 100.000 - 64 Box", value: 100000 },
      { label: "Rp 145.000 - 101 Box", value: 145000 },
      { label: "Rp 200.000 - 159 Box", value: 200000 },
      { label: "Rp 265.000 - 207 Box", value: 265000 },
      { label: "Rp 295.000 - 353 Box", value: 295000 }
    ]
  },
  {
    name: "Black Diamond",
    logo: "assets/img/blackdiamond.png",
    prices: [
      { label: "Rp 60.000 - 36 Box", value: 60000 },
      { label: "Rp 75.000 - 53 Box", value: 75000 },
      { label: "Rp 100.000 - 72 Box", value: 100000 },
      { label: "Rp 145.000 - 115 Box", value: 145000 },
      { label: "Rp 200.000 - 183 Box", value: 200000 },
      { label: "Rp 265.000 - 237 Box", value: 265000 },
      { label: "Rp 295.000 - 404 Box", value: 295000 }
    ]
  }
]
let cart = [];

function getItemId(vipName, label, price) {
  return `${vipName}__${label}__${price}`;
}

function addToCart(vipName, label, price, button) {
  const id = getItemId(vipName, label, price);
  const existingIndex = cart.findIndex(item => item.id === id);

  if (existingIndex !== -1) {
    cart.splice(existingIndex, 1);
    if (button) button.classList.remove("selected");
  } else {
    cart.push({ id, name: `${vipName} - ${label}`, price });
    if (button) button.classList.add("selected");
  }

  updateCartDisplay();
}

function updateCartDisplay() {
  const cartItems = document.getElementById("cartItems");
  cartItems.innerHTML = "";

  cart.forEach(({ id, name, price }) => {
    const li = document.createElement("li");
    li.textContent = name;
    
    const removeBtn = document.createElement("button");
    removeBtn.textContent = " - ";
    removeBtn.className = "remove";
    removeBtn.onclick = () => {
      cart = cart.filter(item => item.id !== id);

      const allButtons = document.querySelectorAll("button");
      allButtons.forEach(btn => {
        if (btn.dataset.itemId === id) {
          btn.classList.remove("selected");
        }
      });

      updateCartDisplay();
    };

    li.appendChild(removeBtn);
    cartItems.appendChild(li);
  });
}

function generatePriceList(containerId, data, iconPath) {
  const container = document.getElementById(containerId);
  data.forEach(vip => {
    const section = document.createElement("div");
    section.className = "vip-section";

    const title = document.createElement("div");
    title.className = "vip-title";

    const logo = document.createElement("img");
    logo.src = vip.name === "Black Diamond"
      ? "assets/img/blackdiamond.png"
      : vip.logo;
    logo.alt = vip.name + " logo";

    title.appendChild(logo);
    title.appendChild(document.createTextNode(" " + vip.name));
    section.appendChild(title);

    vip.prices.forEach(price => {
      const item = document.createElement("div");
      item.className = "item";
      const span = document.createElement("span");
      span.textContent = price.label;

      const icon = document.createElement("img");
      icon.className = "dollar";
      icon.src = iconPath;

      const button = document.createElement("button");
      button.textContent = "Pilih";
      const id = getItemId(vip.name, price.label, price.value);
      button.dataset.itemId = id;
      button.onclick = function () {
        addToCart(vip.name, price.label, price.value, button);
      };

      item.appendChild(span);
      item.appendChild(button);
      item.appendChild(icon);
      section.appendChild(item);
    });

    container.appendChild(section);
  });
}
let currentActiveId = null;

function selectIcon(el) {
  const targetId = el.getAttribute("data-target");
  if (currentActiveId === targetId) {
    el.classList.remove("active");
    const section = document.getElementById(targetId);
    if (section) section.style.display = "none";
    currentActiveId = null;
    return;
  }
  document.querySelectorAll(".icon-wrapper").forEach(wrapper => {
    wrapper.classList.remove("active");
  });
  el.classList.add("active");
  const sections = ["priceListCash", "boxLegend", "poolPass"];
  sections.forEach(sectionId => {
    const section = document.getElementById(sectionId);
    if (section) section.style.display = "none";
  });
  const targetSection = document.getElementById(targetId);
  if (targetSection) targetSection.style.display = "block";

  currentActiveId = targetId;
}

document.getElementById("checkoutBtn").addEventListener("click", () => {
  const items = cart.map(item => `${item.name} - Rp ${item.price.toLocaleString("id-ID")}`);
  const message = encodeURIComponent("Halo Mamet Ucup, saya ingin memesan:\n\n" + items.join("\n"));
  window.open(`https://wa.me/6285713056206?text=${message}`, "_blank");
});

const menuBtn = document.getElementById("menuToggle");
const sideMenu = document.getElementById("sideMenu");
menuBtn.addEventListener("click", function (e) {
  e.stopPropagation(); // cegah event bubble ke body
  sideMenu.classList.toggle("show");
  sideMenu.classList.toggle("hidden");
});
document.addEventListener("click", function (e) {
  const isClickInsideMenu = sideMenu.contains(e.target);
  const isClickOnButton = menuBtn.contains(e.target);

  if (!isClickInsideMenu && !isClickOnButton) {
    sideMenu.classList.remove("show");
    sideMenu.classList.add("hidden");
  }
});
const closeMenuBtn = document.getElementById("closeMenu");
if (closeMenuBtn) {
  closeMenuBtn.addEventListener("click", function () {
    sideMenu.classList.remove("show");
    sideMenu.classList.add("hidden");
  });
}
document.getElementById("modeToggle").addEventListener("click", () => {
  document.body.classList.toggle("dark-mode");
});
const chibi = document.getElementById("chibi");
let isDragging = false;
let offsetX, offsetY;

// Fungsi untuk membatasi posisi agar tidak keluar layar
function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}

// Mouse Events
chibi.addEventListener("mousedown", function (e) {
  isDragging = true;
  offsetX = e.clientX - chibi.offsetLeft;
  offsetY = e.clientY - chibi.offsetTop;
});

document.addEventListener("mousemove", function (e) {
  if (isDragging) {
    let newX = e.clientX - offsetX;
    let newY = e.clientY - offsetY;

    // Batasi gerakan agar tidak keluar layar
    newX = clamp(newX, 0, window.innerWidth - chibi.offsetWidth);
    newY = clamp(newY, 0, window.innerHeight - chibi.offsetHeight);

    chibi.style.left = newX + "px";
    chibi.style.top = newY + "px";
    chibi.style.bottom = "auto";
  }
});

document.addEventListener("mouseup", function () {
  isDragging = false;
});

// Touch Events
chibi.addEventListener("touchstart", function (e) {
  isDragging = true;
  const touch = e.touches[0];
  offsetX = touch.clientX - chibi.offsetLeft;
  offsetY = touch.clientY - chibi.offsetTop;
}, { passive: false });

document.addEventListener("touchmove", function (e) {
  if (isDragging) {
    const touch = e.touches[0];
    let newX = touch.clientX - offsetX;
    let newY = touch.clientY - offsetY;

    // Batasi gerakan agar tidak keluar layar
    newX = clamp(newX, 0, window.innerWidth - chibi.offsetWidth);
    newY = clamp(newY, 0, window.innerHeight - chibi.offsetHeight);

    chibi.style.left = newX + "px";
    chibi.style.top = newY + "px";
    chibi.style.bottom = "auto";
  }
}, { passive: false });

document.addEventListener("touchend", function () {
  isDragging = false;
});
document.querySelectorAll('#sideMenu a').forEach(link => {
  if (link.href === window.location.href) {
    link.classList.add('active');
  }
});
generatePriceList("priceListCash", vipDataCash, "assets/img/dollar.png");
generatePriceList("boxLegend", vipDataBox, "assets/img/box_legends.png");
